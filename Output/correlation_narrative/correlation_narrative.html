<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative: NYC Public Schools Absenteeism</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 960px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1,
        h2,
        h3 {
            color: #333;
        }

        p {
            color: #444;
            line-height: 1.6;
        }

        .figure-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        figure {
            margin: 0;
            padding: 0;
            width: calc(33.33% - 20px);
            /* Adjust the percentage and subtract the margin for proper alignment */
            text-align: center;
            box-sizing: border-box;
            margin-bottom: 20px;
            /* Add some space below each figure */
        }

        .container {
            display: flex;
            justify-content: center;
            flex-wrap: nowrap;
        }

        .image-container {
            position: relative;
            width: 320px;
            height: 240px;
        }

        .image-container img {
            position: absolute;
            top: 0;
            left: 0;
            max-width: 100%;
            height: auto;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        figcaption {
            font-size: 14px;
            padding-top: 10px;
        }

        /* Add custom styling for the button */
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            transition-duration: 0.4s;
        }

        button:hover {
            background-color: #45a049;
            box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19);
        }
    </style>
    <script>
        function switchImage1() {
            const scatterplotImage = document.getElementById('scatterplot1');
            const regressionImage = document.getElementById('regression1');
            const switchButton = document.getElementById('btn1');
            const reg_text = document.getElementById('reg_text1');


            if (scatterplotImage.style.display === 'none') {
                scatterplotImage.style.display = 'block';
                regressionImage.style.display = 'none';
                switchButton.textContent = 'Show Regression';
                reg_text.style.display = 'none';
            } else {
                scatterplotImage.style.display = 'none';
                regressionImage.style.display = 'block';
                switchButton.textContent = 'Hide Regression';
                reg_text.style.display = 'block';
            }
        }

        function switchImage2() {
            const scatterplotImage = document.getElementById('scatterplot2');
            const regressionImage = document.getElementById('regression2');
            const switchButton = document.getElementById('btn2');
            const reg_text = document.getElementById('reg_text2');


            if (scatterplotImage.style.display === 'none') {
                scatterplotImage.style.display = 'block';
                regressionImage.style.display = 'none';
                switchButton.textContent = 'Show Regression';
                reg_text.style.display = 'none';
            } else {
                scatterplotImage.style.display = 'none';
                regressionImage.style.display = 'block';
                switchButton.textContent = 'Hide Regression';
                reg_text.style.display = 'block';
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <h1>NYC Public Schools Absenteeism and its Impact on Test Scores and Demographics</h1>

    <p>
        [Introduction: Briefly introduce the issue of absenteeism in NYC public schools, its impact on student
        performance, and its connection to demographic disparities.]
    </p>
    <p>
        Can add heatmap here?
    </p>

    <h2>Absenteeism Does Not Help Test Scores</h2>

    <p>
        The relationship between attendance and test score performance is strong. Although attendance and test scores
        are both
        correlated with a host of other variables, a simple correlation analysis shows that the relationship bettween
        the two variables
        is statistically significant. On average, for a percentage point increase in attendance we would expect more
        than a four percentage
        point increase in the percentage of students who scored a 3 or 4 (in the top half) of the math test.

        Clearly, absenteeism is a problem in NYC public schools. Unfortunately, it's also a rising one.
    </p>

    <div>
        <img src="attendance_vs_math_all.png" alt="A description of the image" id="scatterplot1" />
        <img src="attendance_vs_math_all_regplot.png" alt="A description of the image" id="regression1"
            style="display:none;" />
    </div>

    <p id="reg_text1" style="display:none;">
        Assuming the model, \(score = \beta_0 + \beta_1 * attendance\), the estimated regression is
        \(\widehat{score} = -335 + 4.2 * attendance\). The estimated slope is 4.2, which means that for a one percentage
        point
        increase in attendance, we would expect a 4.2 percentage point increase in the percentage of students who
        scored a 3 or 4 (in the top half) of the math test.
        <br>
        The slope coefficient is statistically significant even at strict confidence levels, implying that the
        correlation
        between attendance and test scores is strong. This, however, does not imply causation, as there are many omitted
        yet related variables.

    </p>

    <button onclick="switchImage1()" id="btn1">Show Regression</button>


    <h2>Absenteeism is Correlated to Other Variables that Predict Hardship</h2>

    <p>
        <!-- [Section 2: Analyze the relationship between absenteeism and test scores, using data to support your findings.] -->

    </p>

    <p>
        Absenteeism is not a problem that affects all groups equally. It appears to be correlated to other variables
        that tend to predict systemic mistreatment, such as belonging to certain minority groups, lower income groups,
        and (unsurprisingly) chronic absenteeism.
    </p>
    <div class="figure-container" id="scatterplot2">
        <figure>
            <img src="attendance_vs_math_is_black_hispanic_regplot=False.png" alt="Image 1 description" />
            <figcaption>Figure 1: Image 1 Caption</figcaption>
        </figure>

        <figure>
            <img src="attendance_vs_math_is_poverty_regplot=False.png" alt="Image 2 description" />
            <figcaption>Figure 2: Image 2 Caption</figcaption>
        </figure>

        <figure>
            <img src="attendance_vs_math_high_chronic_absenteeism_regplot=False.png" alt="Image 3 description" />
            <figcaption>Figure 3: Image 3 Caption</figcaption>
        </figure>
    </div>

    <div class="figure-container" id="regression2" style="display:none;">
        <figure>
            <img src="attendance_vs_math_is_black_hispanic_custom_reg.png" alt="Image 1 description" />
            <figcaption>Figure 1: Image 1 Caption</figcaption>
        </figure>

        <figure>
            <img src="attendance_vs_math_is_poverty_custom_reg.png" alt="Image 2 description" />
            <figcaption>Figure 2: Image 2 Caption</figcaption>
        </figure>

        <figure>
            <img src="attendance_vs_math_high_chronic_absenteeism_custom_reg.png" alt="Image 3 description" />
            <figcaption>Figure 3: Image 3 Caption</figcaption>
        </figure>
    </div>

    <p id="reg_text2" style="display:none;">
        When we explore heterogeneity in the relationship between attendance and test scores, we find
        some striking differences.
        <br>
        Districts with a higher percentage of black and hispanic students and districts with a higher percentage of
        students
        in poverty tend to have a smaller percentage of students that achieve level 3 or level 4 (in the top half) on
        the exam.
        Districts with a higher percentage of students with chronic absenteeism, however, tend to have the test scores
        you would
        expect, <em>after controlling for the district's overall attendance</em>.
        <br>
        To see this in the data, we can plot the relationship between score and attendance, giving each group
        it's own intercept term. Plotted above, we estimate the following model for each group:
        <br>
        \[score = \beta_0 + \beta_1 * attendance + \beta_2 * demographic\_variable \]
        <br>
        The estimated regressions are:
        <br>
        \[\widehat{score} = -174 + 2.3 * attendance - 17.8 * black\_hispanic \]
        <br>
        \[\widehat{score} = -234 + 3.0 * attendance - 14.8 * poverty \]
        <br>
        \[\widehat{score} = -319 + 4.0 * attendance - 1.1 * chronic\_absenteeism \]
        <br>
        The variables <em>black_hispanic</em> and <em>poverty</em> are statistically significant,
        while the variable <em>chronic_absenteeism</em> is not. Note that each of these variables
        is a dummy/binary variable denoting whether or not the district has more students in this
        category than the medium district.
    </p>

    <button onclick="switchImage2()" id="btn2">Show Regression</button>



    <h2>The Persistent Relationship Between Absenteeism and Test Scores</h2>

    <!-- <p>
        [Section 3: Explore the demographic disparities related to absenteeism, such as differences among race, gender,
        and socioeconomic status.]
    </p> -->

    <p>
        Despite the fact that absenteeism is correlated with other variables that predict hardship, the correlation
        between absenteeism and test scores is strong across groups.
    </p>
    <p>
        In the figures below, notice that the slopes in a regression line are similar across groups.
    </p>

    <div class="figure-container">
        <figure>
            <img src="attendance_vs_math_is_black_hispanic_regplot=True.png" alt="Image 1 description" />
            <figcaption>Figure 1: Image 1 Caption</figcaption>
        </figure>

        <figure>
            <img src="attendance_vs_math_is_poverty_regplot=True.png" alt="Image 2 description" />
            <figcaption>Figure 2: Image 2 Caption</figcaption>
        </figure>

        <figure>
            <img src="attendance_vs_math_high_chronic_absenteeism_regplot=True.png" alt="Image 3 description" />
            <figcaption>Figure 3: Image 3 Caption</figcaption>
        </figure>
    </div>

    <h2>Interactive Map: Absenteeism in NYC Public School Districts</h2>

    <p>
        [Embed your interactive map here. You can use an iframe to embed the "nyc_absenteeism_map.html" file.]
        <iframe src="nyc_absenteeism_map.html" width="100%" height="600px" style="border:none;"></iframe>
    </p>

    <h2>Addressing the Issue: Strategies and Solutions</h2>

    <p>
        [Conclusion: Suggest potential strategies and solutions to tackle the absenteeism problem and its associated
        effects on test scores and demographic disparities.]
    </p>
</body>

</html>